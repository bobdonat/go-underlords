# Dota Underlords

[![GoDoc Widget]][GoDoc] [![Go Report Card Widget]][Go Report Card]

[GoDoc]: https://godoc.org/github.com/paralin/go-underlords
[GoDoc Widget]: https://godoc.org/github.com/paralin/go-underlords
[Go Report Card Widget]: https://goreportcard.com/badge/github.com/paralin/go-underlords
[Go Report Card]: https://goreportcard.com/report/github.com/paralin/go-underlords

## Introduction 

**go-underlords** is a DOTA Auto Chess (Underlords) client plugin for go-steam.
The intent is to replicate as much of the client functionality as possible.

Also see the [Dota2](https://github.com/paralin/go-underlords) implementation.

This project makes use of a dynamic API generator (apigen) designed to
automatically interpret Valve's various naming conventions into a intermediate
API scheme representation, which is then converted into Go code.

## SOCache Mechanism

The caching mechanism makes it easy to watch for changes to common objects, like
`Lobby, LobbyInvite, Party, PartyInvite`.

This mechanism is used everywhere, these objects are not exposed in their own
events.

```go
import (
	gcmm "github.com/paralin/go-underlords/protocol"
	"github.com/paralin/go-underlords/cso"
)

eventCh, eventCancel, err := dota.GetCache().SubscribeType(cso.Lobby)
if err != nil {
    return err
}

defer eventCancel()

lobbyEvent := <-eventCh
lobby := lobbyEvent.Object.(*gcmm.CSODACLobby)
```

Events for the object type are emitted on the eventCh. Be sure to call
`eventCancel` once you are done with the channel to prevent resource leaks.

The cache object also adds interfaces to get and list the current objects in the
cache.

## Implementation Generation

The base API implementation is generated by the [apigen](./apigen) code. Using
heuristics, request IDs are matched to response IDs, and events and action-only
requests are identified. Some manual tweaking is done in the overrides file.

Next, the API information is used to build a Go code-gen set of implementations
around the `MakeRequest` request tracking mechanism.

This means that ALL of the Underlords API will be available in this codebase,
although only some of it is documented.

## go-steam Dependency

This library depends on `go-steam`. Currently we are using the [FACEIT fork](https://github.com/faceit/go-steam).

